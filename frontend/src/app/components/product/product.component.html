<div class="product-management">
  <div class="product-header">
    <h2>ðŸ“¦ Product Management</h2>
    <div class="header-right">
      <!-- Search Bar and Filters -->
      <div class="filters-section-modern">
        <div class="search-container">
          <input 
            type="text" 
            [(ngModel)]="searchQuery" 
            (input)="onSearch()" 
            placeholder="ðŸ” Search products..."
            class="search-input-modern">
        </div>
        <div class="status-filter-modern">
          <label>Status:</label>
          <select id="statusFilter" [(ngModel)]="statusFilter" (change)="onStatusFilterChange()" class="filter-select-modern">
            <option value="all">All</option>
            <option value="Available">Available</option>
            <option value="Out of Stock">Out of Stock</option>
            <option value="Discontinued">Discontinued</option>
          </select>
        </div>
      </div>
      <button class="btn btn-add-modern" (click)="openAddModal()">
        <span class="btn-icon">+</span> Add
      </button>
    </div>
  </div>
  
  <!-- Modal Popup for Add/Edit Product -->
  <div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{ editMode ? 'Edit Product' : 'Add New Product' }}</h3>
        <div class="barcode-note">*Barcode will be generated by system</div>
        <button class="close-modal-btn" (click)="closeModal()">Ã—</button>
      </div>
      
      <form (ngSubmit)="onSubmit()" class="product-form">
        <div class="form-row">
          <div class="form-group">
            <label>Supplier Name *</label>
            <input type="text" [(ngModel)]="product.supplierName" name="supplierName" required>
          </div>
          
          <div class="form-group">
            <label>Supplier GST Number *</label>
            <input type="text" [(ngModel)]="product.supplierGstNumber" name="supplierGstNumber" required placeholder="e.g., 22AAAAA0000A1Z5">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Product Name *</label>
            <input type="text" [(ngModel)]="product.productName" name="productName" required>
          </div>
          <div class="form-group">
            <label>HSN Code *</label>
            <input type="text" [(ngModel)]="product.hsnCode" name="hsnCode" required placeholder="e.g., 52081100">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Wholesale Price (â‚¹) *</label>
            <input type="number" [(ngModel)]="product.wholesalePrice" name="wholesalePrice" required step="0.01">
          </div>
          
          <div class="form-group">
            <label>Retail Price (â‚¹) *</label>
            <input type="number" [(ngModel)]="product.retailPrice" name="retailPrice" required step="0.01">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Fabric Type *</label>
            <select [(ngModel)]="product.fabricType" name="fabricType" required>
              <option value="">Select...</option>
              <option value="Other">Other</option>
              <option value="Cotton">Cotton</option>
              <option value="Silk">Silk</option>
              <option value="Polyester">Polyester</option>
              <option value="Wool">Wool</option>
              <option value="Linen">Linen</option>
              <option value="Rayon">Rayon</option>
              <option value="Blend">Blend</option>
              <option value="Denim">Denim</option>
              <option value="Chiffon">Chiffon</option>
              <option value="Georgette">Georgette</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Pattern *</label>
            <select [(ngModel)]="product.pattern" name="pattern" required>
              <option value="">Select...</option>
              <option value="Other">Other</option>
              <option value="Printed">Printed</option>
              <option value="Plain">Plain</option>
              <option value="Striped">Striped</option>
              <option value="Checked">Checked</option>
              <option value="Solid">Solid</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Size *</label>
            <input type="text" [(ngModel)]="product.size" name="size" required placeholder="e.g., L or 32">
          </div>
          
          <div class="form-group">
            <label>Quantity *</label>
            <input type="number" [(ngModel)]="product.quantity" name="quantity" required>
          </div>
        </div>

        <!-- <div class="form-row">
          <div class="form-group">
            <label>HSN Code *</label>
            <input type="text" [(ngModel)]="product.hsnCode" name="hsnCode" required placeholder="e.g., 52081100">
          </div>
          
          <div class="form-group">
            <label>Barcode *</label>
            <input type="text" [(ngModel)]="product.barcode" name="barcode" required>
          </div>
        </div> -->

        <div class="form-actions">
          <div class="action-buttons">
            <button type="submit" class="btn btn-primary" [disabled]="loading">
              {{ editMode ? 'Update Product' : 'Add Product' }}
            </button>
            <button type="button" class="btn btn-secondary" (click)="closeModal()">
              Cancel
            </button>
          </div>
          <div class="form-group status-selector">
            <div class="status-options">
              <label class="status-option available" [class.selected]="product.status === 'Available'">
                <input type="radio" name="status" value="Available" [(ngModel)]="product.status">
                <span class="status-icon">âœ“</span>
                <span class="status-text">Available</span>
              </label>
              <label class="status-option out-of-stock" [class.selected]="product.status === 'Out of Stock'">
                <input type="radio" name="status" value="Out of Stock" [(ngModel)]="product.status">
                <span class="status-icon">âš </span>
                <span class="status-text">Out of Stock</span>
              </label>
              <label class="status-option discontinued" [class.selected]="product.status === 'Discontinued'">
                <input type="radio" name="status" value="Discontinued" [(ngModel)]="product.status">
                <span class="status-icon">âœ•</span>
                <span class="status-text">Discontinued</span>
              </label>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Products Table -->
  <div class="table-container">
    <div *ngIf="loading" class="loading">Loading...</div>
    
    <table class="data-table" *ngIf="!loading && paginatedProducts.length > 0">
      <thead>
        <tr>
          <th>S.No</th>
          <th>Product Name</th>
          <th>Barcode</th>
          <th>HSN</th>
          <th>Supplier</th>
          <th>Fabric</th>
          <th>Size</th>
          <th>Qty</th>
          <th>Wholesale</th>
          <th>Retail</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let p of paginatedProducts; let i = index">
          <td>{{ (currentPage - 1) * itemsPerPage + i + 1 }}</td>
          <td><strong>{{ p.productName }}</strong></td>
          <td>{{ p.barcode }}</td>
          <td>{{ p.hsnCode }}</td>
          <td>{{ p.supplierName }}</td>
          <td>{{ p.fabricType }}</td>
          <td>{{ p.size }}</td>
          <td>{{ p.quantity }}</td>
          <td>â‚¹{{ p.wholesalePrice }}</td>
          <td><strong>â‚¹{{ p.retailPrice }}</strong></td>
          <td>
            <span class="status-badge" 
              [class.available]="p.status === 'Available'" 
              [class.out-of-stock]="p.status === 'Out of Stock'"
              [class.discontinued]="p.status === 'Discontinued'">
              {{ p.status || 'Available' }}
            </span>
          </td>
          <td class="actions-cell">
            <button class="btn btn-sm btn-warning" (click)="editProduct(p)" title="Edit">Edit</button>
            <button class="btn btn-sm btn-danger" (click)="deleteProduct(p.id)" title="Delete">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Pagination -->
    <div class="pagination-container" *ngIf="!loading && totalItems > itemsPerPage">
      <div class="pagination-info">
        Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to 
        {{ Math.min(currentPage * itemsPerPage, totalItems) }} of {{ totalItems }} products
      </div>
      <div class="pagination-controls">
        <button class="btn btn-sm btn-secondary" (click)="changePage(1)" [disabled]="currentPage === 1">
          First
        </button>
        <button class="btn btn-sm btn-secondary" (click)="changePage(currentPage - 1)" [disabled]="currentPage === 1">
          Prev
        </button>
        <span class="page-numbers">
          <button 
            *ngFor="let pageNum of getPageNumbers()" 
            class="btn btn-sm" 
            [class.btn-primary]="pageNum === currentPage"
            [class.btn-secondary]="pageNum !== currentPage"
            (click)="changePage(pageNum)">
            {{ pageNum }}
          </button>
        </span>
        <button class="btn btn-sm btn-secondary" (click)="changePage(currentPage + 1)" [disabled]="currentPage === totalPages">
          Next
        </button>
        <button class="btn btn-sm btn-secondary" (click)="changePage(totalPages)" [disabled]="currentPage === totalPages">
          Last
        </button>
      </div>
      <div class="page-size-selector">
        <label>Per page:</label>
        <select [(ngModel)]="itemsPerPage" (change)="onPageSizeChange()" class="page-size-select">
          <option [value]="10">10</option>
          <option [value]="25">25</option>
          <option [value]="50">50</option>
          <option [value]="100">100</option>
        </select>
      </div>
    </div>

    <div *ngIf="!loading && paginatedProducts.length === 0" class="no-products">
      <p>No products found.</p>
    </div>
  </div>
</div>
